var $;let windowWidth=0;const isDefaultMode="default"===facebookChatSettings.display_mode;let isNotAvailableWork=!1;function createFacebookChat(t){$=t,windowWidth=document.body.clientWidth;const e=document.getElementsByTagName("head")[0];let o=document.createElement("link");if(o.href=`${rootLinkChat}client/omg-facebook-chat_style.css?v=${Math.floor(Date.now()/1e3)}`,o.type="text/css",o.rel="stylesheet",e.appendChild(o),0==parseInt(facebookChatSettings.show_after))setTimeCreateChat();else{const t=parseInt(facebookChatSettings.show_after)>5?1e3*parseInt(facebookChatSettings.show_after):5e3;setTimeout((function(){setTimeCreateChat()}),t)}$(document).on("click",".fb_dialog.fb_dialog_mobile iframe",(function(t){if(windowWidth<800&&"1"==facebookChatSettings.chat_type){let t=facebookChatSettings.page_info.id;window.open("https://www.messenger.com/t/"+t,"_blank")}}))}function iconChatClickAvailable(){let t=0;const e=setInterval(()=>{let o=$(".fb-customerchat.fb_invisible_flow.fb_iframe_widget iframe");t++,t>40&&clearInterval(e),windowWidth>1025&&o.length&&o.hasClass("fb_customer_chat_bounce_in_v2")&&("fb_bounce_in_v2"===o.css("animation-name")&&"1"==facebookChatSettings.auto_display||"0"==facebookChatSettings.auto_display)&&(o.removeClass("fb_customer_chat_bounce_in_v2"),clearInterval(e))},50);setInterval(()=>{let t=$(".fb-customerchat.fb_invisible_flow.fb_iframe_widget iframe");if(t.length){t=$(".fb-customerchat.fb_invisible_flow.fb_iframe_widget iframe");let e=400;t.css("width")&&(e=parseInt(t.css("width"),10));const o=(windowWidth-e)/100*parseInt(facebookChatSettings.position);t.css("left",o)}},500),$(document).on("click",".ot-fb-logo",(function(){processFbBoxChat()}))}function iconChatClickUnavailable(){if(!("messOpt"===facebookChatSettings.working_time.not_available_option&&windowWidth<=1025)){if("messOpt"!==facebookChatSettings.working_time.not_available_option){const t=setInterval(()=>{$("#fb-root").length&&($(".ot-fb-logo").css("z-index","99999999999999"),$("#fb-root .fb_iframe_widget iframe").addClass("ot-fb-hide"),clearInterval(t))},50)}isDefaultMode&&$(".otFacbookChat").append('<div class="facebook-chat-button-custom"></div>'),$(document).on("click",".ot-fb-logo, .facebook-chat-button-custom",(function(){$(".available-work-container").hasClass("ot-fb-hide")?$(".fb-customerchat.fb_invisible_flow.fb_iframe_widget iframe").hasClass("fb_customer_chat_bounce_in_v2")&&"messOpt"===facebookChatSettings.working_time.not_available_option?processFbBoxChat("not-available"):$(".available-work-container").removeClass("ot-fb-hide").addClass("ot-fb-flex"):closeNotAvailableOpt()}))}}function setTimeCreateChat(){if(facebookChatSettings.page_target&&"0"!==facebookChatSettings.page_target){const t=window.location.pathname;let e="";if("/"===t)e="template-index";else if(t.startsWith("/collections/"))e="template-collection";else if(t.startsWith("/products/"))e="template-product";else if(t.startsWith("/cart"))e="template-cart";else if(t.startsWith("/search"))e="template-search";else if(t.startsWith("/pages/")){e=t.replace("/pages/","")}if("1"===facebookChatSettings.page_target){if(facebookChatSettings.specific_pages.indexOf(e)<0)return void console.log("Not specifics page")}else if("2"===facebookChatSettings.page_target){if(facebookChatSettings.exclude_pages.indexOf(e)>=0)return void console.log("excludes page")}}const t=facebookChatInit();$(".otFacbookChat").append(t);facebookChatSettings.position>50?$(".icon-text-content").addClass("icon-text-content-left"):$(".icon-text-content").addClass("icon-text-content-right"),"0"==facebookChatSettings.auto_display&&windowWidth>1024&&"default"!=facebookChatSettings.display_mode&&$("#fb-root").addClass("ot-fb-hide")}function facebookChatInit(){let t="",e=window.location.protocol+"//"+window.location.host+"/"+window.location.pathname+window.location.search;return"2"===facebookChatSettings.status_connect&&"1"===facebookChatSettings.app_status&&(t+=makeHtml(e)+callInitFaceBook(),getStyleCustom()),t}function makeHtml(t){facebookChatSettings.language;const e=facebookChatSettings.theme_color,o=facebookChatSettings.greeting_message.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;"),a=facebookChatSettings.page_info,n=facebookChatSettings.icon_type;let i=windowWidth>=1025?facebookChatSettings.icon_text:"";const s=facebookChatSettings.icon_text_color,c=facebookChatSettings.tab_color,l=facebookChatSettings.tab_size,f=facebookChatSettings.tab_style,b=i?"has_text":"none_text";let r="28px";"medium"==l?r="32px":"large"==l&&(r="36px");const g=`color: ${s}; background-color: ${c}; line-height: ${r};`,d=iconHtml?""+iconHtml[n]:"",h=`<span  style='${g}' class='ml-1 icon-text-content'> ${i}</span>`,_="1"==facebookChatSettings.auto_display?"show":"hide",m="1"==facebookChatSettings.chat_type?"redirect_icon":"";let p="";0===$("body #fb-root").length&&(OMGFBisCheckFBRoot=!0,p+="<div id='fb-root'></div>");const u=isDefaultMode?"":`<div class='ot-fb-logo ${m} facebook-chat-button ${l} ${f} ${b}' style='${"one_box"==f?"background-color: "+c+";":""}'>\n            <div class='ot-fb-icon' style='background-color: ${c}; fill: ${s};'>\n            ${d}\n            </div>\n            ${h}\n        </div>`,k="messOpt"===facebookChatSettings.working_time.not_available_option&&facebookChatSettings.abTests.available_working_time_Aug_2021?`<div class="fb-mess-widget available-work-container ot-fb-hide">\n                <i class="fb-mess__close" onClick="closeNotAvailableOpt()">\n                    <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0" y="0"\n                        width="10px" height="10px" viewBox="0 0 123.05 123.05" style="enable-background:new 0 0 123.05 123.05;"\n                        xml:space="preserve">\n                        <g>\n                            <path d="M121.325,10.925l-8.5-8.399c-2.3-2.3-6.1-2.3-8.5,0l-42.4,42.399L18.726,1.726c-2.301-2.301-6.101-2.301-8.5,0l-8.5,8.5\n                                c-2.301,2.3-2.301,6.1,0,8.5l43.1,43.1l-42.3,42.5c-2.3,2.3-2.3,6.1,0,8.5l8.5,8.5c2.3,2.3,6.1,2.3,8.5,0l42.399-42.4l42.4,42.4\n                                c2.3,2.3,6.1,2.3,8.5,0l8.5-8.5c2.3-2.3,2.3-6.1,0-8.5l-42.5-42.4l42.4-42.399C123.625,17.125,123.625,13.325,121.325,10.925z"/>\n                        </g>\n                    </svg>\n                </i>\n                <p class="fb-mess-widget__text">${convertHtml(facebookChatSettings.working_time.fb_messages)}</p>\n                <button style='background-color: ${s};' onClick="fbMessageNotAvailable()" id="unavailable-working-fb-chat">\n                <svg\n                    viewBox="0 0 40 40"\n                    x="0"\n                    y="0"\n                    width="16px"\n                    height="16px"\n                >\n                    <g\n                    stroke="none"\n                    strokeWidth=1\n                    fill="none"\n                    fillRule="evenodd"\n                    >\n                    <g>\n                        <svg x="0" y="0">\n                        <path\n                            d="M20,0 C31.2666,0 40,8.2528 40,19.4 C40,30.5472 31.2666,38.8 20,38.8 C17.9763,38.8 16.0348,38.5327 14.2106,38.0311 C13.856,37.9335 13.4789,37.9612 13.1424,38.1098 L9.1727,39.8621 C8.1343,40.3205 6.9621,39.5819 6.9273,38.4474 L6.8184,34.8894 C6.805,34.4513 6.6078,34.0414 6.2811,33.7492 C2.3896,30.2691 0,25.2307 0,19.4 C0,8.2528 8.7334,0 20,0 Z M7.99009,25.07344 C7.42629,25.96794 8.52579,26.97594 9.36809,26.33674 L15.67879,21.54734 C16.10569,21.22334 16.69559,21.22164 17.12429,21.54314 L21.79709,25.04774 C23.19919,26.09944 25.20039,25.73014 26.13499,24.24744 L32.00999,14.92654 C32.57369,14.03204 31.47419,13.02404 30.63189,13.66324 L24.32119,18.45264 C23.89429,18.77664 23.30439,18.77834 22.87569,18.45674 L18.20299,14.95224 C16.80079,13.90064 14.79959,14.26984 13.86509,15.75264 L7.99009,25.07344 Z"\n                            fill="#FFFFFF"\n                        />\n                        </svg>\n                    </g>\n                    </g>\n                </svg>\n                <span class="fb-mess-widget__btn-text">\n                    Leave us a message\n                </span>\n                </button>\n            </div>`:"",C="emailOpt"===facebookChatSettings.working_time.not_available_option&&facebookChatSettings.abTests.available_working_time_Aug_2021?`<div class="fb-email-form available-work-container ot-fb-hide">\n                <i class="fb-mess__close" onClick="closeNotAvailableOpt()">\n                    <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n                        width="10px" height="10px" viewBox="0 0 123.05 123.05" style="enable-background:new 0 0 123.05 123.05;"\n                        xml:space="preserve">\n                        <g>\n                            <path d="M121.325,10.925l-8.5-8.399c-2.3-2.3-6.1-2.3-8.5,0l-42.4,42.399L18.726,1.726c-2.301-2.301-6.101-2.301-8.5,0l-8.5,8.5\n                                c-2.301,2.3-2.301,6.1,0,8.5l43.1,43.1l-42.3,42.5c-2.3,2.3-2.3,6.1,0,8.5l8.5,8.5c2.3,2.3,6.1,2.3,8.5,0l42.399-42.4l42.4,42.4\n                                c2.3,2.3,6.1,2.3,8.5,0l8.5-8.5c2.3-2.3,2.3-6.1,0-8.5l-42.5-42.4l42.4-42.399C123.625,17.125,123.625,13.325,121.325,10.925z"/>\n                        </g>\n                    </svg>\n                </i>\n                <h3>Leave us a message</h3>\n                <div class="fb-email-form__email">\n                    <label for="otEmail">Email</label>\n                    <input type="text" id="otEmail" name="otEmail" />\n                </div>\n            <div  class="fb-email-form__subject">\n                <label for="otSubject">Subject</label>\n                    <input type="text" id="otSubject" name="otSubject" />\n            </div>\n                <div class="fb-email-form__textarea">\n                    <label for="otMessage">Message</label>\n                    <textarea\n                        type="text" id="otMessage" name="otMessage"\n                    />\n                </div>\n                <button class="fb-email-form__submit" style='background-color: ${s};' onClick="submitEmailForm()">\n                    Submit\n                </button>\n            </div>`:"";return p+=` \n            <div class='fb-customerchat'\n                attribution='setup_tool'\n                fb-xfbml-state='rendered'\n                page_id='${a.id}'\n                themeColor='${e}'\n                logged_in_greeting="${o}"\n                logged_out_greeting="${o}"\n                rel='${t}'\n                greeting_dialog_display='${_}'\n                >\n            </div> \n            ${u}\n            ${k}\n            ${C}\n        </div>\n    `,p}function convertHtml(t){return t.replace(/</g,"&lt;").replace(/>/g,"&gt;")}function callInitFaceBook(){const t=facebookChatSettings.device_target;let e="",o=!1,a=!1;if(facebookChatSettings.working_time){const t=facebookChatSettings.working_time;if("0"==t.status){let e="";const n={"-12":"Pacific/Midway","-11":"Pacific/Midway","-10":"Pacific/Honolulu","-9":"America/Anchorage","-8":"America/Los_Angeles","-7":"America/Cambridge_Bay","-6":"America/Mexico_City","-5":"America/Atikokan","-4":"Canada/Atlantic","-3":"America/Sao_Paulo","-2":"America/Noronha","-1":"Atlantic/Azores",0:"Europe/London",1:"Europe/Amsterdam",2:"Europe/Bucharest",3:"Asia/Baghdad",4:"Asia/Muscat",5:"Asia/Karachi",6:"Asia/Almaty",7:"Asia/Bangkok",8:"Asia/Hong_Kong",9:"Asia/Irkutsk",10:"Australia/Brisbane",11:"Asia/Vladivostok",12:"Pacific/Auckland"};e=Object.keys(n).indexOf(t.time_zone)>-1?n[t.time_zone]:t.time_zone;let i=(new Date).toLocaleString("en-US",{timeZone:e});i=new Date(i);const s=i.getFullYear(),c=i.getMonth(),l=i.getDay(),f=i.getHours(),b=i.getMinutes();let r;if(facebookChatSettings.weekdays){r=facebookChatSettings.weekdays;let t=[];for(const e of Object.values(r))t.push(parseInt(e.id));-1===t.indexOf(parseInt(l))&&(a=setAvailableWork())}const g=new Date(s,c,l,f,b).getTime();let d=t.start.split(":");const h=new Date(s,c,l,d[0],d[1]).getTime();let _=t.end.split(":");const m=new Date(s,c,l,_[0],_[1]).getTime();h<g&&m>g?(console.log(g,h,m),o=!1):o=setAvailableWork()}}a||o?(isNotAvailableWork=!0,iconChatClickUnavailable()):iconChatClickAvailable(),"1"==t?$(".otFacbookChat").addClass("hide-mobile"):"2"==t&&$(".otFacbookChat").addClass("hide-desktop");return e+="\n            <script>\n            if (OMGFBisCheckFBRoot) {\n                window.fbAsyncInit = function() {\n                    FB.init({\n                        appId:  "+(facebookChatSettings.appIdFB?facebookChatSettings.appIdFB:"1919748194980000")+",\n                        autoLogAppEvents : true,\n                        xfbml            : true,\n                        version          : 'v11.0'\n                    });\n                };\n            }\n            \n            (function(d, s, id) {\n                var js, fjs = d.getElementsByTagName(s)[0];\n                if (d.getElementById(id)) return;\n                js = d.createElement(s); \n                js.id = id;\n                js.src = 'https://connect.facebook.net/"+facebookChatSettings.language+"/sdk/xfbml.customerchat.js';\n                fjs.parentNode.insertBefore(js, fjs);\n            }(document, 'script', 'facebook-jssdk'));\n        <\/script>",e}function setAvailableWork(){return console.log("Facebook live chat by Omega: Not in the working days"),"noneOpt"===facebookChatSettings.working_time.not_available_option&&$(".otFacbookChat").addClass("ot-fb-hide"),!0}function getStyleCustom(){const t=setInterval(()=>{if(!isDefaultMode&&$(".ot-fb-logo").length&&"auto"!==$(".ot-fb-logo").css("z-index")||isDefaultMode&&$(".fb_dialog_content iframe")&&$(".fb_dialog_content iframe").width()>0){let e="",o="",a=parseInt(facebookChatSettings.position);const n=parseInt(facebookChatSettings.margin_bottom),i=1==facebookChatSettings.chat_type?" display: none !important;":"";if(""!==facebookChatSettings.custom_css){const t=facebookChatSettings.custom_css;t.status&&(e=t.code)}let s;switch(facebookChatSettings.tab_size){case"small":s=55;break;case"medium":s=65;break;case"large":s=75;break;default:s=80}const c=windowWidth<1025||isDefaultMode?60:$(".ot-fb-logo").width(),l=(windowWidth-c)/100*parseInt(a);o+=`<style type='text/css'>\n                .fb_iframe_widget iframe {\n                    bottom: ${n+s}px !important;\n                }\n                \n                .otFacbookChat .available-work-container {\n                    left: ${(windowWidth-$(".available-work-container").width())/100*parseInt(a)+"px !important;"};\n                    bottom: ${n+s+6}px !important;\n                }\n                \n                .fb_dialog {\n                    left: ${l}px !important;\n                }\n                \n                .fb_dialog .fb_dialog_content {\n                    ${isDefaultMode?"":"opacity: 0.002!important;"}\n                }\n                \n                .facebook-chat-button-custom,\n                .ot-fb-logo.facebook-chat-button,\n                .fb_dialog .fb_dialog_content iframe {\n                    bottom: ${n}px !important;\n                    left: ${l}px !important;\n                }\n                \n                .fb_dialog .fb_dialog_content iframe,\n                .fb_dialog .fb_dialog_content #_no-clickjacking-0,\n                .fb_dialog .fb_dialog_content #_no-clickjacking-1 {\n                    ${i}\n                }\n                \n                .ot-fb-logo.facebook-chat-button {\n                    direction: ${a>50?"rtl":"ltr"};\n                }\n                \n                @media screen and (max-width: 1025px) {\n                    .fb_iframe_widget iframe {\n                        left: auto !important;\n                        bottom: ${n+50}px !important;\n                        ${i}\n                    }\n                \n                    .fb_dialog.fb_dialog_mobile  {\n                        bottom: ${n}px!important;\n                    }\n                }\n                \n                ${e}\n            </style>`,$(".otFacbookChat").append(o),clearInterval(t)}},50)}function initFBChat(){const t=facebookChatSettings.appIdFB?facebookChatSettings.appIdFB:"1919748194980000";FB&&FB.init({appId:t,autoLogAppEvents:!0,xfbml:!0,version:"v11.0"})}function closeNotAvailableOpt(){$(".available-work-container").removeClass("ot-fb-flex").addClass("ot-fb-hide")}function submitEmailForm(){const t=$(".fb-email-form__email input").val(),e=$(".fb-email-form__subject input").val(),o=$(".fb-email-form__textarea textarea").val();return new Promise(a=>{$.ajax({url:rootLinkChat+"backend/storefront/facebook-message.php",data:{email:t,subject:e,message:o,action:"sendMessage",shop:shopFbChat},dataType:"JSON",type:"POST"}).done((function(t){}))})}function fbMessageNotAvailable(){$(document).on("click","#unavailable-working-fb-chat",(function(){processFbBoxChat("not-available")}))}function processFbBoxChat(t=""){$("#fb-root").addClass("ot-fb-show"),"not-available"===t&&closeNotAvailableOpt();const e=$(".fb-customerchat.fb_invisible_flow.fb_iframe_widget iframe");if(windowWidth<800&&$(".ot-fb-logo.redirect_icon").length>0){let t=facebookChatSettings.page_info.id;window.open("https://www.messenger.com/t/"+t,"_blank")}windowWidth<=1025||($(".fb-customerchat").children().length||($("#fb-root .fb-customerchat").children().length||initFBChat(),FB.Event.subscribe("customerchat.show",processShowDialog("callToGetPopup")),window.OMGFBisGetPopup="getPopup"),e.hasClass("fb_customer_chat_bounce_out_v2")||!e.hasClass("fb_customer_chat_bounce_out_v2")&&!e.hasClass("fb_customer_chat_bounce_in_v2")?FB.Event.subscribe("customerchat.show",processShowDialog(OMGFBisGetPopup)):FB.Event.subscribe("customerchat.hide",processHideDialog(OMGFBisGetPopup)))}function processShowDialog(t=""){!t&&FB.CustomerChat&&FB.CustomerChat.show(!0),"callToGetPopup"==t&&FB.XFBML.parse(),omgFBAddRemoveClassShowHide()}function processHideDialog(t=""){!t&&FB.CustomerChat&&FB.CustomerChat.hideDialog(),omgFBAddRemoveClassShowHide("remove")}function omgFBAddRemoveClassShowHide(t="add"){const e="remove"===t?"0":"calc(100% - 80px)",o="remove"===t?"fb_customer_chat_bounce_out_v2":"fb_customer_chat_bounce_in_v2",a="remove"===t?"fb_customer_chat_bounce_in_v2":"fb_customer_chat_bounce_out_v2",n=setInterval(()=>{let i=$(".fb-customerchat.fb_invisible_flow.fb_iframe_widget iframe");i.length&&("add"===t&&setTimeout(()=>{i=$(".fb-customerchat.fb_invisible_flow.fb_iframe_widget iframe"),"fb_bounce_in_v2"===i.css("animation-name")&&i.addClass("omg-fb-set-height")},250),i.css("max-height",e),i.removeClass(a).addClass(o),clearInterval(n))},50)}window.OMGFBisGetPopup="",window.OMGFBisCheckFBRoot=!1,facebookChatSettings.page_info="string"==typeof facebookChatSettings.page_info?JSON.parse(facebookChatSettings.page_info):facebookChatSettings.page_info,facebookChatSettings.specific_pages="string"==typeof facebookChatSettings.specific_pages?JSON.parse(facebookChatSettings.specific_pages):facebookChatSettings.specific_pages,facebookChatSettings.exclude_pages="string"==typeof facebookChatSettings.exclude_pages?JSON.parse(facebookChatSettings.exclude_pages):facebookChatSettings.exclude_pages,facebookChatSettings.specific_pages="string"==typeof facebookChatSettings.specific_pages?JSON.parse(facebookChatSettings.specific_pages):facebookChatSettings.specific_pages,facebookChatSettings.working_time="string"==typeof facebookChatSettings.working_time?JSON.parse(facebookChatSettings.working_time):facebookChatSettings.working_time,facebookChatSettings.custom_css="string"==typeof facebookChatSettings.custom_css?JSON.parse(facebookChatSettings.custom_css):facebookChatSettings.custom_css,facebookChatSettings.weekdays="string"==typeof facebookChatSettings.weekdays?JSON.parse(facebookChatSettings.weekdays):facebookChatSettings.weekdays,facebookChatSettings.abTests="string"==typeof facebookChatSettings.abTests?JSON.parse(facebookChatSettings.abTests):facebookChatSettings.abTests;